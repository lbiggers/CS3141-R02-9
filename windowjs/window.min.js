function Window(a,b){"use strict";function c(L){WindowUtil.getProperty(b,"resizable",!0)&&(K=!0,w.classList.add("window_resizing"),H=L.target.getAttribute("data-resize"),document.body.style.cursor=I[H],G.x=L.clientX,G.y=L.clientY,w.classList.add("window_no_animation"),document.addEventListener("mouseup",d),document.addEventListener("mousemove",f),document.body.classList.add("text_not_selectable"),v.on("resize_start")(L))}function d(L){L&&L.preventDefault(),0>=b.position.y&&v.maximize(),document.body.style.cursor="",w.classList.remove("window_no_animation"),w.classList.remove("window_resizing"),K=!1,document.removeEventListener("mouseup",d),document.removeEventListener("mousemove",f),document.body.classList.remove("text_not_selectable"),v.on("resize_stop")(L)}function f(L){if(L.preventDefault(),!1==K)return void d();var M=0,N=0,O=WindowUtil.getProperty(b,"min_size",{width:200,height:150}),P=WindowUtil.getProperty(b,"max_size","");("nw"==H||"n"==H||"ne"==H)&&(D.height>O.height||L.clientY<b.position.y)&&(N=-(G.y-L.clientY),O.height<=D.height-N&&(""==P||P.height>=D.height-N)&&(b.position.y+=N)),("ne"==H||"e"==H||"se"==H)&&(D.width>O.width||L.clientX>b.position.x+D.width)&&(M=G.x-L.clientX),("sw"==H||"s"==H||"se"==H)&&(D.height>O.height||L.clientY>b.position.y+D.height)&&(N=G.y-L.clientY),("nw"==H||"w"==H||"sw"==H)&&(D.width>O.width||L.clientX<b.position.x)&&(M=-(G.x-L.clientX),O.width<=D.width-M&&(""==P||P.width>=D.width-M)&&(b.position.x+=M)),("nw"==H||"n"==H||"ne"==H||"w"==H||"sw"==H)&&n(),G.x=L.clientX,G.y=L.clientY,v.changeOption("size",{width:D.width-M,height:D.height-N}),l(),v.on("resize")(L)}function g(L){if(!K){if(!v.isNormalSized()){w.classList.add("window_no_animation"),v.normalSize();var M=w.getElementsByClassName("window_bar")[0];v.changeOption("position",{x:L.clientX-M.offsetWidth/2,y:L.clientY-M.offsetHeight/2}),w.classList.remove("window_no_animation")}if(L.preventDefault(),!1==J)return void h();var N=F.x-L.clientX,O=F.y-L.clientY;F.x=L.clientX,F.y=L.clientY,v.changeOption("position",{x:w.offsetLeft-N,y:w.offsetTop-O}),n(),v.on("move")(L)}}function h(L){L&&L.preventDefault(),w.classList.remove("window_moving"),0>=b.position.y&&v.maximize(),document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",h),v.on("move_stop")(L)}function j(L){w.classList.remove("window_maximized");var M=w.getElementsByClassName("window_button_toggle_maximize")[0];switch(L){case WindowState.MAXIMIZED:{w.classList.add("window_maximized"),M.innerHTML=WindowUtil.getProperty(b,"normalsize_icon","&#10697;");break}case WindowState.NORMAL:{M.innerHTML=WindowUtil.getProperty(b,"maximize_icon","&#9744;");break}default:M.innerHTML=WindowUtil.getProperty(b,"maximize_icon","&#9744;"),console.warn("This state is not allowed ("+L+"); skipping");}}function k(L){switch(w.classList.remove("window_hidden"),w.classList.remove("window_minimized"),L){case WindowState.HIDDEN:{w.classList.add("window_hidden");break}case WindowState.MINIMIZED:{w.classList.add("window_minimized");break}case WindowState.SHOWN:break;default:console.warn("This window-state is not allowed ("+L+"); skipping");}}function l(){if(y){var L=WindowUtil.getProperty(b,"size","");""==L&&(b.size={width:200,height:150},L=b.size);var M={width:b.size.width,height:b.size.height};D.width=WindowUtil.getProperty(L,"width",200),D.height=WindowUtil.getProperty(L,"height",150);var N=WindowUtil.getProperty(b,"min_size",{width:200,height:150}),O=WindowUtil.getProperty(b,"max_size","");if(""!=N){var P=WindowUtil.getProperty(N,"width",""),Q=WindowUtil.getProperty(N,"height","");""!=P&&D.width<P&&(D.width=P,b.size.width=D.width),""!=Q&&D.height<Q&&(D.height=Q,b.size.height=D.height)}if(""!=O){var R=WindowUtil.getProperty(O,"width",""),S=WindowUtil.getProperty(O,"height","");""!=R&&D.width>R&&(D.width=R,b.size.width=D.width),""!=S&&D.height>S&&(D.height=S,b.size.height=D.height)}var T=w.parentElement;D.height>T.offsetHeight&&(D.height=T.offsetHeight,b.size.height=D.height,b.position.y=0),D.width>T.offsetWidth&&(D.width=T.offsetWidth,b.size.width=D.width,b.position.x=0),w.style.width=D.width+"px",w.style.height=D.height+"px",n(),v.on("update_size")({old:M,size:D})}}function m(){if(y){v.on("update_selected")();var L=WindowUtil.getProperty(b,"selected",!1);L?(w.classList.add("window_selected"),v.on("select")()):(w.classList.remove("window_selected"),v.on("deselect")())}}function n(){if(y){var L=w.parentElement,M=WindowUtil.getProperty(b,"position","");""==M&&(b.position={x:L.offsetWidth/2-w.offsetWidth/2,y:L.offsetHeight/2-w.offsetHeight/2},M=b.position);var N={x:b.position.x,y:b.position.y};E.x=WindowUtil.getProperty(M,"x",0),E.y=WindowUtil.getProperty(M,"y",0),0>E.x&&(E.x=0),0>E.y&&(E.y=0),E.x>L.offsetWidth-w.offsetWidth&&(E.x=L.offsetWidth-w.offsetWidth,b.position.x=E.x),E.y>L.offsetHeight-w.offsetHeight&&(E.y=L.offsetHeight-w.offsetHeight,b.position.y=E.y),w.style.left=E.x+"px",w.style.top=E.y+"px",v.on("update_position")({old:N,new:E})}}function o(){for(var L=WindowUtil.getProperty(b,"events",{}),M=Object.keys(L),N=0;N<M.length;N++)z[M[N]]=L[M[N]]}function p(){y&&(WindowUtil.getProperty(b,"bar_visible",!0)?w.classList.remove("window_bar_hidden"):w.classList.add("window_bar_hidden"))}function q(){WindowUtil.getProperty(b,"resizable",!0)?w.classList.remove("window_not_resizable"):w.classList.add("window_not_resizable")}function r(){WindowUtil.getProperty(b,"movable",!0)?w.classList.remove("window_not_movable"):w.classList.add("window_not_movable")}function s(){WindowUtil.getProperty(b,"maximizable",!0)?w.classList.remove("window_not_maximizable"):w.classList.add("window_not_maximizable")}function t(){WindowUtil.getProperty(b,"minimizable",!0)?w.classList.remove("window_not_minimizable"):w.classList.add("window_not_minimizable")}function u(){WindowUtil.getProperty(b,"always_on_top",!1)?w.classList.add("window_alway_on_top"):w.classList.remove("window_alway_on_top")}var v=this,w=null,x=Window.count++,y=!0,z={},A=WindowState.HIDDEN,B=WindowState.NORMAL,D={width:0,height:0},E={x:0,y:0},F={x:0,y:0},G={x:0,y:0},H=null,I={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize",nw:"nwse-resize"},J=!1,K=!1;if(this.content=null,"string"!=typeof a)throw new Error("Parameter 1 must be of type string");if("undefined"!=typeof b){if("object"!=typeof b)throw new Error("Parameter 2 must be of type object");if(B=WindowUtil.getProperty(b,"state",WindowState.NORMAL),B!=WindowState.NORMAL&&B!=WindowState.MAXIMIZED)throw new Error("'state' must be WindowState.NORMAL or WindowState.MAXIMIZED")}else b={};this.getTitle=function(){return y?a:void 0},this.setTitle=function(L){if(y){if("string"!=typeof L)throw new Error("Parameter 1 must be of type string");v.on("change_title")({old:a,"new":L}),a=L,null!==typeof w&&(w.getElementsByClassName("window_title")[0].innerHTML=a)}},this.getContainer=function(){if(y)return null==w&&console.warn("Container not yet created"),w},this.changeOption=function(L,M){if(y)if("string"!=typeof L)throw new Error("Parameter 1 must be of type string");else if("undefined"==typeof M)throw new Error("Parameter 2 must be set");else if(b[L]=M,null!=w)switch(L){case"icon":{w.getElementsByClassName("window_icon")[0].innerHTML=M;break}case"minimize_icon":{w.getElementsByClassName("window_button_minimize")[0].innerHTML=M;break}case"maximize_icon":{j(B);break}case"normalsize_icon":{j(B);break}case"close_icon":{w.getElementsByClassName("window_button_close")[0].innerHTML=M;break}case"size":{l();break}case"position":{n();break}case"selected":{m();break}case"min_size":{l();break}case"max_size":{l();break}case"events":{o();break}case"bar_visible":{p();break}case"resizable":{q();break}case"movable":{r();break}case"maximizable":{s();break}case"minimizable":{t();break}case"always_on_top":{u();break}default:this.reload();}},this.getOptions=function(){return y?b:void 0},this.reload=function(){if(y=!0,WindowUtil.getProperty(b,"container",null)!==w&&null!=w&&(w.remove(),w=null),null==w){var L=WindowUtil.getProperty(b,"container",document.body);w=document.createElement("div"),w.className="window",w.id="window_"+x,w.window=v,L.appendChild(w)}l(),n(),m(),o(),p(),q(),r(),s(),t(),u(),A=WindowUtil.getProperty(b,"window_state",WindowState.SHOWN),k(A),w.innerHTML="";var M=document.createElement("div");M.className="window_bar";var N=document.createElement("span");N.className="window_icon",N.innerHTML=WindowUtil.getProperty(b,"icon","");var O=document.createElement("span");O.className="window_title",O.innerHTML=a;var P=document.createElement("div");P.className="window_toggle_buttons";var Q=document.createElement("span");Q.className="window_button_minimize",Q.innerHTML=WindowUtil.getProperty(b,"minimize_icon","_");var R=document.createElement("span");R.className="window_button_toggle_maximize";var S=document.createElement("span");S.className="window_button_close",S.innerHTML=WindowUtil.getProperty(b,"close_icon","&#9587;"),P.appendChild(Q),P.appendChild(R),P.appendChild(S),M.appendChild(N),M.appendChild(O),M.appendChild(P),w.appendChild(M);for(var W,T=[],U=["n","ne","e","se","s","sw","w","nw"],V=0;8>V;V++)W=document.createElement("div"),W.className="window_resize_handle window_resize_handle_"+U[V],W.setAttribute("data-resize",U[V]),W.addEventListener("mousedown",c),W.style.cursor=I[U[V]],T.push(W),w.appendChild(W);j(B),null==this.content&&(this.content=document.createElement("div"),this.content.className="window_content"),w.appendChild(this.content);var X=0;M.addEventListener("mousedown",function(Y){if(0==Y.button){if(J=!0,WindowUtil.getProperty(b,"movable",!0)){for(var Z=Y.target;Z!=M;)if(Z!=Q&&Z!=R&&Z!=S)Z=Z.parentElement;else return;Y.preventDefault(),F.x=Y.clientX,F.y=Y.clientY,w.classList.add("window_moving"),document.addEventListener("mousemove",g),document.addEventListener("mouseup",h)}X++,1==X&&setTimeout(function(){1==X?v.on("move_start")(Y):v.toggleMaximize(),X=0},Window.DOUBLE_CLICK_DELAY)}}),M.addEventListener("mouseup",function(Y){0!=Y.button||(J=!1)}),Q.addEventListener("click",function(Y){Y.preventDefault(),v.minimize()}),R.addEventListener("click",function(Y){Y.preventDefault(),v.toggleMaximize()}),S.addEventListener("click",function(Y){Y.preventDefault(),v.close()}),o(),v.on("reload")()},this.changeState=function(L){if(y){if(L!=WindowState.NORMAL&&L!=WindowState.MAXIMIZED)throw new Error("Parameter 1 must be WindowState.NORMAL or WindowState.MAXIMIZED");v.on("change_state")({old:B,"new":L}),B=L,j(L)}},this.changeWindowState=function(L){if(y){if(L!=WindowState.MINIMIZED&&L!=WindowState.HIDDEN&&L!=WindowState.SHOWN)throw new Error("Parameter 1 must be WindowState.HIDDEN or WindowState.MINIMIZED or WindowState.SHOWN");v.on("change_window_state")({old:A,"new":L}),A=L,k(A)}},this.minimize=function(){y&&WindowUtil.getProperty(b,"minimizable",!0)&&!1!==v.on("minimizing")&&(this.changeWindowState(WindowState.MINIMIZED),v.on("minimize")())},this.normalSize=function(){y&&(this.changeState(WindowState.NORMAL),v.on("normalSize")())},this.maximize=function(){y&&WindowUtil.getProperty(b,"maximizable",!0)&&!1!==v.on("maximizing")&&(this.changeState(WindowState.MAXIMIZED),l(),v.on("maximize")())},this.toggleMaximize=function(){y&&(B==WindowState.NORMAL?v.maximize():v.normalSize())},this.hide=function(){y&&(this.changeWindowState(WindowState.HIDDEN),v.on("hide")())},this.show=function(){y&&(this.changeWindowState(WindowState.SHOWN),v.on("show")())},this.on=function(L,M){return y?"undefined"==typeof M?"function"==typeof z[L]?z[L]:function(){}:void(z[L]=M):void 0},this.removeOn=function(L){y&&delete z[L]},this.getState=function(){return y?B:void 0},this.getWindowState=function(){return y?A:void 0},this.getSize=function(){return y?D:void 0},this.getPosition=function(){return y?E:void 0},this.isMinimized=function(){return y?A==WindowState.MINIMIZED:void 0},this.isHidden=function(){return y?A==WindowState.HIDDEN:void 0},this.isShown=function(){return y?A==WindowState.SHOWN:void 0},this.isVisible=function(){return y?!(this.isMinimized()||this.isHidden()):void 0},this.isMaximized=function(){return y?B==WindowState.MAXIMIZED:void 0},this.isNormalSized=function(){return y?B==WindowState.NORMAL:void 0},this.reset=function(){y&&(this.show(),this.normalSize(),v.on("reset")())},this.close=function(){var L=WindowUtil.getProperty(b,"close_action",Window.DISPOSE_ON_CLOSE);y&&L!=Window.DO_NOTHING_ON_CLOSE&&(!1===v.on("closing")()||(this.hide(),v.on("closed")(),L==Window.DISPOSE_ON_CLOSE&&this.dispose()))},this.dispose=function(){!1!==v.on("disposing")()&&(this.content.remove(),this.content=null,w.remove(),w=null,v.on("disposed")(),y=!1)},this.reload(),v.on("init")()}Window.count=0,Window.DISPOSE_ON_CLOSE=0,Window.HIDE_ON_CLOSE=1,Window.DO_NOTHING_ON_CLOSE=2,Window.DOUBLE_CLICK_DELAY=300;const WindowState={NORMAL:0,MAXIMIZED:1,MINIMIZED:2,SHOWN:3,HIDDEN:4},WindowUtil={getProperty:function(a,b,c){return"undefined"==typeof a[b]?c:a[b]}};
